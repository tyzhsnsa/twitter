name: Sanity check env lengths
  run: |
    node -e "const ks=['TW_APP_KEY','TW_APP_SECRET','TW_ACCESS_TOKEN','TW_ACCESS_SECRET','GEMINI_API_KEY']; ks.forEach(k=>{const v=process.env[k]||''; console.log(k, 'len =', v.length);});"

name: Daily Tweet

on:
  schedule:
    - cron: "0 1 * * *"   # JST 10:00
  workflow_dispatch:

jobs:
  tweet:
    runs-on: ubuntu-latest
    env:
      GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
      TW_APP_KEY: ${{ secrets.TW_APP_KEY }}
      TW_APP_SECRET: ${{ secrets.TW_APP_SECRET }}
      TW_ACCESS_TOKEN: ${{ secrets.TW_ACCESS_TOKEN }}
      TW_ACCESS_SECRET: ${{ secrets.TW_ACCESS_SECRET }}

    steps:
      - uses: actions/checkout@v3

      - uses: actions/setup-node@v4
        with:
          node-version: 20

      - name: Install deps
        run: npm ci || npm i

      # 実行ログを直接コンソールに出す（リダイレクトしない）
      - name: Run bot
        run: node post.js

      # 参考：ファイルに吐いている場合はこれで中身を表示
      - name: Show post_log (if exists)
        run: |
          if [ -f logs/post_log.txt ]; then
            echo "----- logs/post_log.txt -----"
            cat logs/post_log.txt
          fi
